<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monster Activity Configuration Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #f0f0f0;
        }

        .main-content {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .left-panel, .right-panel {
            flex: 1;
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            margin-bottom: 15px;
            color: #4a9eff;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #bbb;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 14px;
        }

        input[type="number"] {
            width: 100px;
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .checkbox-label input {
            cursor: pointer;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stats-grid .form-group {
            margin-bottom: 10px;
        }

        .drop-table {
            background: #1a1a1a;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
        }

        .drop-table-headers {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: #222;
            border-radius: 4px;
            font-weight: bold;
            font-size: 13px;
            color: #4a9eff;
        }

        .drop-table-headers .header-item {
            flex: 2;
            padding-left: 32px; /* Account for icon width + gap */
        }

        .drop-table-headers .header-quantity {
            flex: 1;
            min-width: 100px;
        }

        .drop-table-headers .header-chance {
            flex: 1;
            min-width: 80px;
        }

        .drop-table-headers .header-action {
            width: 80px;
        }

        .drop-item {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: #333;
            border-radius: 4px;
        }

        .drop-item input {
            width: auto;
        }

        .drop-item .quantity-input {
            flex: 1;
            min-width: 100px;
        }

        .drop-item .chance-input {
            flex: 1;
            min-width: 80px;
        }

        .btn {
            padding: 8px 16px;
            background: #4a9eff;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #3a8eef;
        }

        .btn-danger {
            background: #d32f2f;
        }

        .btn-danger:hover {
            background: #f44336;
        }

        .btn-success {
            background: #4caf50;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-add {
            background: #66bb6a;
            margin-top: 10px;
        }

        .btn-add:hover {
            background: #4caf50;
        }

        .json-output {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        .actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .existing-monsters {
            max-height: 200px;
            overflow-y: auto;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
        }

        .monster-list-item {
            padding: 5px 10px;
            cursor: pointer;
            transition: background 0.2s;
            border-radius: 3px;
        }

        .monster-list-item:hover {
            background: #333;
        }

        .monster-list-item.selected {
            background: #2a4a6a;
            color: #4a9eff;
        }

        .warning {
            background: #553300;
            border: 1px solid #aa6600;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-size: 13px;
        }

        .success {
            background: #003300;
            border: 1px solid #00aa00;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-size: 13px;
        }

        .item-search {
            position: relative;
        }

        .item-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            max-height: 500px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .item-suggestions.active {
            display: block;
        }

        .item-suggestion {
            padding: 8px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .item-suggestion:hover {
            background: #444;
        }

        .item-suggestion.selected {
            background: #2a4a6a;
        }

        .item-icon {
            width: 20px;
            height: 20px;
            object-fit: contain;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .drop-item-display {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 2;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Monster Activity Configuration Tool</h1>

        <div class="main-content">
            <!-- Left Panel -->
            <div class="left-panel">
                <div class="section">
                    <h3>Monster Selection</h3>
                    <div class="form-group">
                        <label>Monster Name:</label>
                        <input type="text" id="monsterName" placeholder="e.g., Goblin">
                    </div>
                    <div class="form-group">
                        <label>Existing Monsters (click to edit):</label>
                        <div class="existing-monsters" id="existingMonsters"></div>
                    </div>
                </div>

                <div class="section">
                    <h3>Requirements</h3>
                    <div class="stats-grid">
                        <div class="form-group">
                            <label>Required Level:</label>
                            <input type="number" id="requiredLevel" min="1" max="99" value="1">
                        </div>
                        <div class="form-group">
                            <label>Required Slayer Level:</label>
                            <input type="number" id="requiredSlayerLevel" min="1" max="99" value="1">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Combat Stats</h3>
                    <div class="stats-grid">
                        <div class="form-group">
                            <label>Hitpoints:</label>
                            <input type="number" id="stat-hitpoints" min="1" value="10">
                        </div>
                        <div class="form-group">
                            <label>Attack:</label>
                            <input type="number" id="stat-attack" min="0" value="1">
                        </div>
                        <div class="form-group">
                            <label>Strength:</label>
                            <input type="number" id="stat-strength" min="0" value="1">
                        </div>
                        <div class="form-group">
                            <label>Defence:</label>
                            <input type="number" id="stat-defence" min="0" value="1">
                        </div>
                        <div class="form-group">
                            <label>Ranged:</label>
                            <input type="number" id="stat-ranged" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Magic:</label>
                            <input type="number" id="stat-magic" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Prayer:</label>
                            <input type="number" id="stat-prayer" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Slayer (auto):</label>
                            <input type="number" id="stat-slayer" min="0" value="1" readonly style="background: #333;">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>XP Rewards</h3>
                    <div class="stats-grid">
                        <div class="form-group">
                            <label>Prayer XP per Kill:</label>
                            <input type="number" id="xp-prayer" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Slayer XP per Kill:</label>
                            <input type="number" id="xp-slayer" min="0" value="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <div class="section">
                    <h3>Drop Table</h3>
                    <div class="drop-table" id="dropTable">
                        <div class="drop-table-headers">
                            <div class="header-item">Item Name</div>
                            <div class="header-quantity">Quantity</div>
                            <div class="header-chance">Chance</div>
                            <div class="header-action"></div>
                        </div>
                        <div id="dropTableItems">
                            <!-- Drop items will be added here -->
                        </div>
                    </div>
                    <button class="btn btn-add" onclick="addDropItem()">Add Drop Item</button>
                </div>

                <div class="section">
                    <h3>JSON Preview</h3>
                    <div class="json-output" id="jsonOutput">No configuration yet...</div>
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-success" onclick="exportMonsterOnly()">Export Monster Only</button>
            <button class="btn btn-success" onclick="copyMonsterToClipboard()">Copy Monster to Clipboard</button>
            <button class="btn btn-success" onclick="exportFullFile()">Export Full Activities File</button>
            <button class="btn btn-success" onclick="copyFullToClipboard()">Copy Full to Clipboard</button>
            <button class="btn" onclick="generatePreview()">Update Preview</button>
            <button class="btn btn-danger" onclick="clearForm()">Clear Form</button>
        </div>
    </div>

    <script>
        let allItems = {};
        let allActivities = {};
        let existingMonsters = new Set();
        let dropCounter = 0;

        // Initialize
        async function init() {
            await loadItems();
            await loadActivities();
            setupEventListeners();
            addDropItem(); // Add first drop item
        }

        // Load items from JSON
        async function loadItems() {
            try {
                const response = await fetch('../data/items.json');
                allItems = await response.json();
                console.log('Items loaded:', Object.keys(allItems).length);
            } catch (error) {
                console.error('Error loading items:', error);
                alert('Warning: Could not load items.json. Item validation will be disabled.');
            }
        }

        // Load activities from JSON
        async function loadActivities() {
            try {
                const response = await fetch('../data/activities.json');
                allActivities = await response.json();
                
                // Find existing monsters (combat activities)
                const combatSkills = ['attack', 'strength', 'defence', 'ranged', 'magic', 'combat'];
                Object.entries(allActivities).forEach(([id, activity]) => {
                    if (combatSkills.includes(activity.skill) && activity.monsterName) {
                        existingMonsters.add(activity.monsterName);
                    }
                });
                
                renderExistingMonsters();
            } catch (error) {
                console.error('Error loading activities:', error);
            }
        }

        // Render existing monsters list
        function renderExistingMonsters() {
            const container = document.getElementById('existingMonsters');
            container.innerHTML = '';
            
            if (existingMonsters.size === 0) {
                container.innerHTML = '<div style="color: #666;">No existing monsters found</div>';
                return;
            }
            
            Array.from(existingMonsters).sort().forEach(monster => {
                const div = document.createElement('div');
                div.className = 'monster-list-item';
                div.textContent = monster;
                div.onclick = () => loadMonster(monster);
                container.appendChild(div);
            });
        }

        // Load existing monster data
        function loadMonster(monsterName) {
            // Clear previous selection
            document.querySelectorAll('.monster-list-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Find all activities for this monster
            const monsterActivities = Object.entries(allActivities).filter(([id, activity]) => 
                activity.monsterName === monsterName && ['attack', 'strength', 'defence', 'ranged', 'magic', 'combat'].includes(activity.skill)
            );
            
            if (monsterActivities.length === 0) return;
            
            // Mark as selected
            event.target.classList.add('selected');
            
            // Use first activity as template (all should have same stats)
            const [firstId, firstActivity] = monsterActivities[0];
            
            // Set monster name
            document.getElementById('monsterName').value = monsterName;
            
            // Set requirements
            document.getElementById('requiredLevel').value = firstActivity.requiredLevel || 1;
            document.getElementById('requiredSlayerLevel').value = firstActivity.requiredSlayerLevel || 1;
            
            // Set combat stats
            document.getElementById('stat-hitpoints').value = firstActivity.hitpoints || 10;
            document.getElementById('stat-attack').value = firstActivity.attack || 0;
            document.getElementById('stat-strength').value = firstActivity.strength || 0;
            document.getElementById('stat-defence').value = firstActivity.defence || 0;
            document.getElementById('stat-ranged').value = firstActivity.ranged || 0;
            document.getElementById('stat-magic').value = firstActivity.magic || 0;
            document.getElementById('stat-prayer').value = firstActivity.prayer || 0;
            document.getElementById('stat-slayer').value = firstActivity.slayer || firstActivity.requiredSlayerLevel || 1;
            
            // Set XP rewards
            document.getElementById('xp-prayer').value = (firstActivity.xpPerKill && firstActivity.xpPerKill.prayer) || 0;
            document.getElementById('xp-slayer').value = (firstActivity.xpPerKill && firstActivity.xpPerKill.slayer) || 0;
            
            // Load drop table
            document.getElementById('dropTableItems').innerHTML = '';
            dropCounter = 0;
            if (firstActivity.dropTable) {
                firstActivity.dropTable.forEach(drop => {
                    addDropItem(drop.itemId, drop.quantity, drop.chance);
                });
            }
            
            if (!firstActivity.dropTable || firstActivity.dropTable.length === 0) {
                addDropItem();
            }
            
            generatePreview();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Auto-update slayer stat when slayer level changes
            document.getElementById('requiredSlayerLevel').addEventListener('input', (e) => {
                document.getElementById('stat-slayer').value = e.target.value;
            });
            
            // Auto-generate preview on changes
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    if (input.type === 'checkbox' || input.id !== 'monsterName') {
                        generatePreview();
                    }
                });
            });
        }

        // Parse chance input (handles fractions like "1/10")
        function parseChance(value) {
            if (value.includes('/')) {
                const parts = value.split('/');
                if (parts.length === 2) {
                    const numerator = parseFloat(parts[0]);
                    const denominator = parseFloat(parts[1]);
                    if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
                        return Math.round((numerator / denominator) * 10000) / 10000; // Round to 4 decimal places
                    }
                }
            }
            const parsed = parseFloat(value);
            return isNaN(parsed) ? 1.0 : Math.round(parsed * 10000) / 10000;
        }

        // Add drop item row
        function addDropItem(itemId = '', quantity = '1', chance = 1.0) {
            const dropTableItems = document.getElementById('dropTableItems');
            const dropId = dropCounter++;
            
            const dropItem = document.createElement('div');
            dropItem.className = 'drop-item';
            dropItem.id = `drop-${dropId}`;
            
            // Get item image if itemId exists
            let itemImageHtml = '';
            if (itemId && allItems[itemId]) {
                const imagePath = itemId === 'coins' ? '../assets/items/coins_1.png' : `../assets/items/${itemId}.png`;
                itemImageHtml = `<img src="${imagePath}" alt="${allItems[itemId].name}" class="item-icon" onerror="this.style.visibility='hidden'">`;
            }
            
            dropItem.innerHTML = `
                <div class="drop-item-display">
                    <div id="item-display-${dropId}" style="display: flex; align-items: center; min-width: 20px;">
                        ${itemImageHtml}
                    </div>
                    <div class="item-search" style="flex: 1;">
                        <input type="text" id="item-${dropId}" placeholder="Item ID (e.g., coins)" value="${itemId}"
                               onkeyup="handleItemSearch(${dropId}, this.value)" 
                               onblur="setTimeout(() => hideSuggestions(${dropId}), 200)"
                               onchange="updateItemOnChange(${dropId})">
                        <div class="item-suggestions" id="suggestions-${dropId}"></div>
                    </div>
                </div>
                <input type="text" class="quantity-input" id="quantity-${dropId}" 
                       placeholder="Qty (e.g., 1 or 3-15)" value="${quantity}"
                       onchange="generatePreview()">
                <input type="text" class="chance-input" id="chance-${dropId}" 
                       placeholder="Chance (e.g., 0.1 or 1/10)" value="${chance}"
                       onchange="handleChanceChange(${dropId})">
                <button class="btn btn-danger" onclick="removeDropItem(${dropId})">Remove</button>
            `;
            
            dropTableItems.appendChild(dropItem);
        }

        // Update item on manual change
        function updateItemOnChange(dropId) {
            const itemId = document.getElementById(`item-${dropId}`).value.trim();
            if (itemId && allItems[itemId]) {
                updateItemDisplay(dropId, itemId, allItems[itemId].name);
            } else {
                updateItemDisplay(dropId, '', '');
            }
            generatePreview();
        }

        // Handle chance change
        function handleChanceChange(dropId) {
            const input = document.getElementById(`chance-${dropId}`);
            const value = input.value;
            const parsed = parseChance(value);
            input.value = parsed;
            generatePreview();
        }

        // Handle item search
        function handleItemSearch(dropId, query) {
            const suggestionsDiv = document.getElementById(`suggestions-${dropId}`);
            
            if (!query) {
                hideSuggestions(dropId);
                return;
            }
            
            let matches;
            
            // Show all items when "*" is typed
            if (query === '*') {
                matches = Object.entries(allItems);
            } else {
                matches = Object.entries(allItems)
                    .filter(([id, item]) => 
                        id.includes(query.toLowerCase()) || 
                        item.name.toLowerCase().includes(query.toLowerCase())
                    )
                    .slice(0, 10);
            }
            
            if (matches.length === 0) {
                hideSuggestions(dropId);
                return;
            }
            
            suggestionsDiv.innerHTML = '';
            matches.forEach(([id, item]) => {
                const div = document.createElement('div');
                div.className = 'item-suggestion';
                
                // Get image path (special case for coins)
                const imagePath = id === 'coins' ? '../assets/items/coins_1.png' : `../assets/items/${id}.png`;
                
                div.innerHTML = `
                    <img src="${imagePath}" alt="${item.name}" class="item-icon" onerror="this.style.visibility='hidden'">
                    <span>${item.name} (${id})</span>
                `;
                
                div.onclick = () => {
                    document.getElementById(`item-${dropId}`).value = id;
                    updateItemDisplay(dropId, id, item.name);
                    hideSuggestions(dropId);
                    generatePreview();
                };
                suggestionsDiv.appendChild(div);
            });
            
            suggestionsDiv.classList.add('active');
        }

        // Update item display with image
        function updateItemDisplay(dropId, itemId, itemName) {
            const itemDisplay = document.getElementById(`item-display-${dropId}`);
            if (itemDisplay && itemId && allItems[itemId]) {
                const imagePath = itemId === 'coins' ? '../assets/items/coins_1.png' : `../assets/items/${itemId}.png`;
                itemDisplay.innerHTML = `
                    <img src="${imagePath}" alt="${itemName}" class="item-icon" onerror="this.style.visibility='hidden'">
                `;
            } else if (itemDisplay) {
                itemDisplay.innerHTML = '';
            }
        }

        // Hide suggestions
        function hideSuggestions(dropId) {
            const suggestionsDiv = document.getElementById(`suggestions-${dropId}`);
            if (suggestionsDiv) {
                suggestionsDiv.classList.remove('active');
            }
        }

        // Remove drop item
        function removeDropItem(dropId) {
            const dropItem = document.getElementById(`drop-${dropId}`);
            if (dropItem) {
                dropItem.remove();
                generatePreview();
            }
        }

        // Generate monster activities
        function generateMonsterActivities() {
            const monsterName = document.getElementById('monsterName').value.trim();
            if (!monsterName) return null;
            
            // Get stats
            const requiredLevel = parseInt(document.getElementById('requiredLevel').value) || 1;
            const requiredSlayerLevel = parseInt(document.getElementById('requiredSlayerLevel').value) || 1;
            
            const stats = {
                hitpoints: parseInt(document.getElementById('stat-hitpoints').value) || 10,
                attack: parseInt(document.getElementById('stat-attack').value) || 0,
                strength: parseInt(document.getElementById('stat-strength').value) || 0,
                defence: parseInt(document.getElementById('stat-defence').value) || 0,
                ranged: parseInt(document.getElementById('stat-ranged').value) || 0,
                magic: parseInt(document.getElementById('stat-magic').value) || 0,
                prayer: parseInt(document.getElementById('stat-prayer').value) || 0,
                slayer: requiredSlayerLevel // Auto-set to slayer level
            };
            
            // Get XP rewards
            const xpPrayer = parseInt(document.getElementById('xp-prayer').value) || 0;
            const xpSlayer = parseInt(document.getElementById('xp-slayer').value) || 0;
            
            const xpPerKill = {};
            if (xpPrayer > 0) xpPerKill.prayer = xpPrayer;
            if (xpSlayer > 0) xpPerKill.slayer = xpSlayer;
            
            // Build drop table
            const dropTable = [];
            document.querySelectorAll('.drop-item').forEach(dropItem => {
                const dropId = dropItem.id.replace('drop-', '');
                const itemId = document.getElementById(`item-${dropId}`).value.trim();
                const quantityStr = document.getElementById(`quantity-${dropId}`).value.trim();
                const chanceStr = document.getElementById(`chance-${dropId}`).value.trim();
                const chance = parseChance(chanceStr);
                
                if (itemId) {
                    // Check if item exists
                    if (!allItems[itemId] && Object.keys(allItems).length > 0) {
                        console.warn(`Warning: Item "${itemId}" not found in items.json`);
                    }
                    
                    // Parse quantity (can be number or range)
                    let quantity = quantityStr;
                    if (!quantityStr.includes('-')) {
                        quantity = parseInt(quantityStr) || 1;
                    }
                    
                    dropTable.push({ itemId, quantity, chance });
                }
            });
            
            // Generate single combat activity
            const activities = {};
            const id = monsterName.toLowerCase().replace(/\s+/g, '_');
            const name = `Fight ${monsterName}s`;
            
            const activity = {
                id,
                name,
                skill: 'combat',
                monsterName,
                requiredLevel,
                requiredSlayerLevel,
                ...stats
            };
            
            if (Object.keys(xpPerKill).length > 0) {
                activity.xpPerKill = xpPerKill;
            }
            
            if (dropTable.length > 0) {
                activity.dropTable = dropTable;
            }
            
            activities[id] = activity;
            
            return activities;
        }

        // Generate preview
        function generatePreview() {
            const activities = generateMonsterActivities();
            const output = document.getElementById('jsonOutput');
            
            if (!activities) {
                output.textContent = 'Please enter a monster name';
                return;
            }
            
            // Format JSON with proper indentation
            const entries = Object.entries(activities);
            let jsonStr = '';
            entries.forEach(([id, activity], index) => {
                jsonStr += '"' + id + '": ' + JSON.stringify(activity, null, 4);
                if (index < entries.length - 1) {
                    jsonStr += ',';
                }
                jsonStr += '\n';
            });
            
            output.textContent = jsonStr.trim();
        }

        // Export monster only (without outer brackets for direct pasting)
        function exportMonsterOnly() {
            const activities = generateMonsterActivities();
            if (!activities) {
                alert('Please configure a monster first');
                return;
            }
            
            // Format without outer brackets
            const entries = Object.entries(activities);
            let jsonStr = '';
            entries.forEach(([id, activity], index) => {
                const activityJson = JSON.stringify(activity, null, 4);
                const indentedJson = activityJson.split('\n').map((line, i) => i === 0 ? line : '    ' + line).join('\n');
                jsonStr += '    "' + id + '": ' + indentedJson;
                if (index < entries.length - 1) {
                    jsonStr += ',';
                }
                jsonStr += '\n';
            });
            
            // Remove trailing newline
            jsonStr = jsonStr.trim();
            
            downloadJSON(jsonStr, 'monster_activities.json');
        }

        // Copy monster to clipboard (without outer brackets)
        function copyMonsterToClipboard() {
            const activities = generateMonsterActivities();
            if (!activities) {
                alert('Please configure a monster first');
                return;
            }
            
            // Format without outer brackets
            const entries = Object.entries(activities);
            let jsonStr = '';
            entries.forEach(([id, activity], index) => {
                const activityJson = JSON.stringify(activity, null, 4);
                const indentedJson = activityJson.split('\n').map((line, i) => i === 0 ? line : '    ' + line).join('\n');
                jsonStr += '    "' + id + '": ' + indentedJson;
                if (index < entries.length - 1) {
                    jsonStr += ',';
                }
                jsonStr += '\n';
            });
            
            // Remove trailing newline
            jsonStr = jsonStr.trim();
            
            navigator.clipboard.writeText(jsonStr).then(() => {
                showNotification('Monster configuration copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            });
        }

        // Copy full file to clipboard
        function copyFullToClipboard() {
            const activities = generateMonsterActivities();
            if (!activities) {
                alert('Please configure a monster first');
                return;
            }
            
            // Merge with existing activities
            const mergedActivities = { ...allActivities };
            
            // Remove old versions of these activities if they exist
            Object.keys(activities).forEach(id => {
                delete mergedActivities[id];
            });
            
            // Add new activities
            Object.assign(mergedActivities, activities);
            
            const jsonStr = JSON.stringify(mergedActivities, null, 4);
            
            navigator.clipboard.writeText(jsonStr).then(() => {
                showNotification('Full activities file copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            });
        }

        // Show notification
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: ${type === 'success' ? '#4caf50' : '#f44336'};
                color: white;
                border-radius: 4px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(400px); }
                    to { transform: translateX(0); }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); }
                    to { transform: translateX(400px); }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                notification.style.animationFillMode = 'forwards';
                setTimeout(() => {
                    document.body.removeChild(notification);
                    document.head.removeChild(style);
                }, 300);
            }, 3000);
        }

        // Export full file
        function exportFullFile() {
            const activities = generateMonsterActivities();
            if (!activities) {
                alert('Please configure a monster first');
                return;
            }
            
            // Merge with existing activities
            const mergedActivities = { ...allActivities };
            
            // Remove old versions of these activities if they exist
            Object.keys(activities).forEach(id => {
                delete mergedActivities[id];
            });
            
            // Add new activities
            Object.assign(mergedActivities, activities);
            
            const jsonStr = JSON.stringify(mergedActivities, null, 4);
            downloadJSON(jsonStr, 'activities.json');
        }

        // Download JSON file
        function downloadJSON(jsonStr, filename) {
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Clear form
        function clearForm() {
            document.getElementById('monsterName').value = '';
            document.getElementById('requiredLevel').value = 1;
            document.getElementById('requiredSlayerLevel').value = 1;
            document.getElementById('stat-hitpoints').value = 10;
            document.getElementById('stat-attack').value = 1;
            document.getElementById('stat-strength').value = 1;
            document.getElementById('stat-defence').value = 1;
            document.getElementById('stat-ranged').value = 0;
            document.getElementById('stat-magic').value = 0;
            document.getElementById('stat-prayer').value = 0;
            document.getElementById('stat-slayer').value = 1;
            document.getElementById('xp-prayer').value = 0;
            document.getElementById('xp-slayer').value = 0;
            
            document.getElementById('dropTableItems').innerHTML = '';
            dropCounter = 0;
            addDropItem();
            
            document.getElementById('jsonOutput').textContent = 'No configuration yet...';
            
            // Clear selection
            document.querySelectorAll('.monster-list-item').forEach(item => {
                item.classList.remove('selected');
            });
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
