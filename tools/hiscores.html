<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scapewatch Hiscores</title>
    
    <style>
        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #fff;
            overflow: auto;
            padding: 20px;
        }

        /* Hiscores container - adapted from modal */
        .hiscores-container {
            background: #2c2416;
            border: 2px solid #5a4a3a;
            border-radius: 5px;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .hiscores-content {
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .hiscores-layout {
            display: flex;
            height: 100%;
            padding: 20px;
            gap: 20px;
            font-size: 20px;
        }

        .hiscores-categories {
            width: 200px;
            background: #1a1611;
            border: 1px solid #3a3025;
            padding: 10px;
            overflow-y: auto;
        }

        .hiscores-leaderboard {
            flex: 1;
            background: #1a1611;
            border: 1px solid #3a3025;
            padding: 20px;
            overflow-y: auto;
        }

        .hiscores-controls {
            width: 250px;
            background: #1a1611;
            border: 1px solid #3a3025;
            padding: 10px;
        }

        .hiscores-title {
            color: #f39c12;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .hiscores-category-item {
            padding: 8px;
            margin: 2px 0;
            cursor: pointer;
            color: #ccc;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .hiscores-category-item:hover {
            background: #2a2015;
        }

        .hiscores-category-item.active {
            background: #3a2520;
            color: #f39c12;
        }

        .category-icon {
            width: 20px;
            height: 20px;
        }

        .hiscores-leaderboard-title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .hiscores-title-icon {
            width: 32px;
            height: 32px;
            vertical-align: middle;
        }

        .hiscores-leaderboard-title {
            color: #f39c12;
            text-align: center;
            margin-bottom: 20px;
        }

        .hiscores-table {
            width: 100%;
            border-collapse: collapse;
            color: #ccc;
        }

        .hiscores-table th {
            background: #2a2015;
            padding: 10px;
            text-align: left;
            color: #f39c12;
        }

        .hiscores-table td {
            padding: 8px;
            border-bottom: 1px solid #2a2015;
        }

        .hiscores-table tr:hover {
            background: #2a2015;
        }

        .hiscores-own-rank {
            background: #3a2520;
        }

        .hiscores-highlight {
            background: #4a3530 !important;
        }

        .hiscores-name {
            color: #5DADE2;
            cursor: pointer;
        }

        .hiscores-name:hover {
            text-decoration: underline;
        }

        .hiscores-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        .hiscores-pagination button {
            padding: 5px 15px;
            background: #3a2520;
            border: 1px solid #5a4a3a;
            color: #ccc;
            cursor: pointer;
        }

        .hiscores-pagination button:hover {
            background: #4a3530;
        }

        .hiscores-search-section {
            margin-bottom: 20px;
        }

        .hiscores-search-section label {
            display: block;
            color: #f39c12;
            margin-bottom: 5px;
        }

        .hiscores-search-input {
            width: 100%;
            padding: 5px;
            background: #2a2015;
            border: 1px solid #3a3025;
            color: #ccc;
            margin-bottom: 5px;
            font-size: 20px;
        }

        .hiscores-search-btn {
            width: 100%;
            padding: 5px;
            background: #3a2520;
            border: 1px solid #5a4a3a;
            color: #ccc;
            cursor: pointer;
        }

        .hiscores-search-btn:hover {
            background: #4a3530;
        }

        .hiscores-your-rank-btn {
            width: 100%;
            padding: 10px;
            background: #f39c12;
            border: none;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .hiscores-your-rank-btn:hover {
            background: #e67e22;
        }

        .hiscores-back-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: #3a2520;
            border: 1px solid #5a4a3a;
            color: #ccc;
            cursor: pointer;
        }

        .hiscores-back-btn:hover {
            background: #4a3530;
        }

        .hiscores-skill-name-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hiscores-inline-icon {
            width: 20px;
            height: 20px;
        }

        .hiscores-compare-table {
            width: 100%;
            border-collapse: collapse;
            color: #ccc;
            margin-bottom: 20px;
        }

        .hiscores-compare-table th {
            background: #2a2015;
            padding: 10px;
            text-align: left;
            color: #f39c12;
            font-size: 16px;
        }

        .hiscores-subheader th {
            background: #221a10;
            font-size: 14px;
            color: #999;
            padding: 5px 10px;
        }

        .hiscores-compare-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #2a2015;
            font-size: 14px;
        }

        .hiscores-compare-rank {
            font-weight: bold;
            min-width: 60px;
        }

        .hiscores-compare-value {
            min-width: 80px;
        }

        .hiscores-compare-winner {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        .hiscores-loading,
        .hiscores-error {
            text-align: center;
            padding: 50px;
            color: #ccc;
            font-size: 18px;
        }

        /* Hide close button since this isn't a modal */
        .modal-close-x {
            display: none;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Loading indicator */
        .loading-indicator {
            text-align: center;
            padding: 20px;
            color: #f39c12;
        }
    </style>
</head>
<body>
    <!-- Main container for hiscores (not a modal) -->
    <div id="hiscores-modal" class="hiscores-container">
        <div class="hiscores-content">
            <button class="modal-close-x" id="hiscores-close-x">Ã—</button>
            <div class="hiscores-layout">
                <!-- Left: Category list -->
                <div class="hiscores-categories" id="hiscores-categories"></div>
                <!-- Center: Leaderboard -->
                <div class="hiscores-leaderboard" id="hiscores-leaderboard">
                    <div class="loading-indicator">Loading hiscores...</div>
                </div>
                <!-- Right: Search/Compare -->
                <div class="hiscores-controls" id="hiscores-controls"></div>
            </div>
        </div>
    </div>

    <script>
        // Helper function for number formatting
        function formatNumber(num) {
            if (num === undefined || num === null) return '0';
            return num.toLocaleString();
        }

        // Minimal LoadingManager implementation
        class MinimalLoadingManager {
            constructor() {
                this.assets = {
                    images: {},
                    data: {}
                };
                this.loadQueue = [];
                this.loaded = 0;
                this.total = 0;
            }

            async initialize() {
                // Load skills data
                try {
                    const response = await fetch('../assets/data/skills.json');
                    this.assets.data.skills = await response.json();
                    console.log('Skills data loaded');
                } catch (error) {
                    console.error('Failed to load skills data:', error);
                    // Provide fallback skills data
                    this.assets.data.skills = this.getDefaultSkillsData();
                }

                // Load skill icons
                const skills = Object.keys(this.assets.data.skills);
                for (const skillId of skills) {
                    await this.loadImage(`skill_${skillId}`, `../assets/skills/${skillId}.png`);
                }

                // Load UI icons
                const uiIcons = ['skills', 'tasks', 'pets', 'pets_shiny', 'all_clue'];
                for (const icon of uiIcons) {
                    await this.loadImage(`skill_${icon}`, `../assets/ui/${icon}.png`);
                }
                
                // Load additional UI icons
                await this.loadImage('ui_tasks', '../assets/ui/tasks.png');
                await this.loadImage('ui_pets', '../assets/ui/pets.png');
                await this.loadImage('ui_pets_shiny', '../assets/ui/pets_shiny.png');
                await this.loadImage('ui_all_clue', '../assets/ui/all_clue.png');

                // Load clue icons
                const clueTypes = ['easy', 'medium', 'hard', 'elite', 'master'];
                for (const type of clueTypes) {
                    await this.loadImage(`items_${type}_clue`, `../assets/items/${type}_clue.png`);
                }
            }

            loadImage(key, path) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        this.assets.images[key] = img;
                        resolve();
                    };
                    img.onerror = () => {
                        console.warn(`Failed to load image: ${path}`);
                        // Create a placeholder
                        this.assets.images[key] = null;
                        resolve();
                    };
                    img.src = path;
                });
            }

            getImage(key) {
                return this.assets.images[key];
            }

            getData(key) {
                return this.assets.data[key];
            }

            // Fallback skills data in case loading fails
            getDefaultSkillsData() {
                return {
                    attack: { name: "Attack" },
                    strength: { name: "Strength" },
                    defence: { name: "Defence" },
                    ranged: { name: "Ranged" },
                    prayer: { name: "Prayer" },
                    magic: { name: "Magic" },
                    runecraft: { name: "Runecraft" },
                    construction: { name: "Construction" },
                    hitpoints: { name: "Hitpoints" },
                    agility: { name: "Agility" },
                    herblore: { name: "Herblore" },
                    thieving: { name: "Thieving" },
                    crafting: { name: "Crafting" },
                    fletching: { name: "Fletching" },
                    slayer: { name: "Slayer" },
                    hunter: { name: "Hunter" },
                    mining: { name: "Mining" },
                    smithing: { name: "Smithing" },
                    fishing: { name: "Fishing" },
                    cooking: { name: "Cooking" },
                    firemaking: { name: "Firemaking" },
                    woodcutting: { name: "Woodcutting" },
                    farming: { name: "Farming" },
                    sailing: { name: "Sailing" }
                };
            }
        }

        // Create global loadingManager instance
        window.loadingManager = new MinimalLoadingManager();

        // Initialize and load everything
        async function initialize() {
            try {
                console.log('Starting initialization...');
                
                // Initialize loading manager first
                await window.loadingManager.initialize();
                console.log('Loading manager initialized');

                // Import Firebase modules and initialize
                const firebaseScript = document.createElement('script');
                firebaseScript.type = 'module';
                firebaseScript.textContent = `
                    // Import Firebase and initialize
                    import '../js/firebase.js';
                    
                    // Wait for Firebase to be ready
                    setTimeout(() => {
                        if (window.firebaseManager) {
                            window.firebaseManager.initialize();
                            console.log('Firebase initialized');
                            
                            // Import HiScores after Firebase is ready
                            import('../js/hiScores.js').then(() => {
                                console.log('HiScores module loaded');
                                
                                // Initialize hiscores manager
                                if (window.hiScoresManager) {
                                    window.hiScoresManager.initialize();
                                    
                                    // Override the close method to do nothing
                                    window.hiScoresManager.close = function() {
                                        console.log('Close method disabled for standalone viewer');
                                    };
                                    
                                    // Auto-open the hiscores
                                    window.hiScoresManager.isOpen = true;
                                    window.hiScoresManager.render();
                                    window.hiScoresManager.loadCategory('overall');
                                    console.log('HiScores initialized and loaded');
                                } else {
                                    console.error('HiScores manager not found');
                                }
                            }).catch(error => {
                                console.error('Failed to load HiScores module:', error);
                            });
                        } else {
                            console.error('Firebase manager not initialized');
                        }
                    }, 1000);
                `;
                document.body.appendChild(firebaseScript);

            } catch (error) {
                console.error('Initialization failed:', error);
                document.getElementById('hiscores-leaderboard').innerHTML = 
                    '<div class="hiscores-error">Failed to initialize hiscores viewer</div>';
            }
        }

        // Start initialization when page loads
        window.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
